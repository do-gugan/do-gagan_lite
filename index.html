<!doctype html>

<html lang="ja">
<head>
  <meta charset="utf-8">

  <title>動画眼Lite</title>
  <style type="text/css">
    body {
        font-size:medium;
        font-family: "Helvetica Neue",Arial,"Hiragino Kaku Gothic ProN","Hiragino Sans",Meiryo,sans-serif;
        background-color: #fff;
    }
    header {

    }
    div#flexcontainer {
        max-width:90%;
        background-color: #ddd;
        display: flex;
        flex-flow: row nowrap;
        justify-content: space-around ;
        height:85vh;
    }
    div#playerContainer {
        background-color: #fff;
        flex-basis:70%;
    }
    div#scripts {
        background-color: #ccc;
        flex-basis:30%;
        overflow-y: scroll;
    }
    div.row {
        display: flex;
        flex-flow: row nowrap;
        margin:0.1em;
        border:1px solid #888;
    }
    div.in {
        background-color: #cfc;
        text-align:right;
        align-self:stretch;
        padding: 0.3em;
        flex-shrink: 1;
        flex-basis:30px;
    }
    div.script {
        background-color: #fff;
        flex-grow: 6;
    }

    div#controls {
        display:flex;
        flex-flow: row nowrap;
        justify-content: center;
    }
    div.controlButton{
        border: 1px solid #333;
        background-color: #aaa;
        padding:0.5em;
        text-align: center;
        width:8em;
        vertical-align: middle;
    }
    div.controlButton:hover{
        background-color: #ccc;        
    }
    span.controlButton{
        letter-spacing:-0.5em;   
    }
    span.shortcut {
        font-size: 70%;
        color:#888;
    }
    div#howto {
        padding-left:3em;
        height:20em;
    }
    footer {
        color:#777;
        text-align:center;
        position:absolute;
        width:100%;
        bottom: 1em;
    }
    img#pause {
        height:12px;
        width:10px;
        margin-top:5px;
        margin-right:6px;
    }

    @media screen and (max-height: 1000px){
        #ahowto {display:none}
    }
  </style>
  <script src="test.json.js" id="scriptsJson"></script>
  <script>

      function initialize(){
        const player = document.getElementById("player");
        isPlaying = false;

        //再生状態チェックイベントハンドラー
        player.addEventListener('playing', (event) => {
            //console.log('Video is played');
            isPlaying = true;
            play();
        });
        player.addEventListener('pause', (event) => {
            //console.log('Video is paused');
            isPlaying = false;
            pause();
        });


        //キーボードショートカットのリスナーをセット
        document.body.addEventListener('keydown',
        event => {
            //alert(event.key);
            if (event.key === 'v' && event.ctrlKey) {
            alert("Ctrl+Vが押されました")
            } else {
                //単体キー
                switch (event.key){
                    case ' ':
                        playToggle();
                        break;
                    case 'q':
                        skipBackward();
                        break;
                    case 'w':
                        skipForward();
                        break;
                }

            }          
        });

        //スキップボタン内の秒数プルダウンメニューでonClickイベントを破棄
        document.getElementById('backwardSec').addEventListener('click', e=> {
            e.stopPropagation()}, false
        )
        document.getElementById('forwardSec').addEventListener('click', e=> {
            e.stopPropagation()}, false
        )

        loadJson();
    }

    //JSONデータをもつjsファイルを読み込み、リストに表示する
    function loadJson(){
        const scriptsJsonSTR = JSON.stringify(scriptsJson)
        var scripts = JSON.parse(scriptsJsonSTR);
        scripts.forEach(scriptRecord => {
            row = "<div class='row' id='" + scriptRecord["in"] + "' onClick='jumpToTimeIndex(" + scriptRecord["in"] + ")'><div class='in'>" + secToMinSec(scriptRecord["in"]) + "</div><div class='script'>" + scriptRecord["script"] + "</div></div>\n";
            document.getElementById("scripts").innerHTML += row;
        });
    }

    //再生制御
    function playToggle(){
        //alert (isPlaying);
        if (isPlaying==true){
            pause();
        } else {
            play();
        }
    }
    function play(){
        player.play();
        document.getElementById('payPause').innerHTML = "▶<span class='shortcut'> (Space)</span>";
    }
    function pause(){
        player.pause();
        document.getElementById('payPause').innerHTML = "<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAAHElEQVQImWNkYGD4z4AAjP//I7iMjIwQDgMDAwBzGQUBc+dnkwAAAABJRU5ErkJggg=='' id='pause' alt='II' /><span class='shortcut'> (Space)</span>";
    }

    function skipForward(){
        var sec = document.getElementById('forwardSec').value;
        jumpToTimeIndex(parseFloat(player.currentTime) + parseFloat(sec));
    }
    function skipBackward(){
        var sec = document.getElementById('backwardSec').value;
        jumpToTimeIndex(parseFloat(player.currentTime) - parseFloat(sec));
    }
    //動画再生位置を指定秒に移動する
    function jumpToTimeIndex(sec){
        //alert(sec); 
        player.currentTime = sec;
        play();
    }

    //秒インデックスを「分：秒」形式に変換
    function secToMinSec(secTotal){
        min = Math.floor(secTotal / 60);
        sec = secTotal - min*60;
        return ( '00' + min ).slice( -2 ) + ":" + ( '00' + sec ).slice( -2 )
    }

  </script>
</head>

<body onLoad="initialize();">
    <header></header>
    <div id="flexcontainer">
        <!--動画プレーヤー-->
        <div id="playerContainer">
            <video controls width="100%" id="player">
                <source src="test.mp4" type="video/mp4">   
                お使いのブラウザはビデオ再生に対応していません。
            </video>
            <div id="controls">
                <div class="controlButton" id="backword" onclick="skipBackward();">
                    <span class="controlButton">◀◀</span> <span class="shortcut">(Q)</span>
                    <select id="backwardSec">
                        <option value=3>3秒</option>
                        <option value=5>5秒</option>
                        <option value=10>10秒</option>
                        <option value=15 selected>15秒</option>
                        <option value=30>30秒</option>
                        <option value=60>1分</option>
                        <option value=120>2分</option>
                        <option value=180>3分</option>
                        <option value=300>5分</option>
                        <option value=600>10分</option>
                    </select>
                </div>
                <div class="controlButton" id="payPause" onClick="playToggle()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAAHElEQVQImWNkYGD4z4AAjP//I7iM
                    jIwQDgMDAwBzGQUBc+dnkwAAAABJRU5ErkJggg==" id="pause" alt="II" /> <span class='shortcut'>(Space)</span></div></dib>
                <div class="controlButton" id="forward" onClick="skipForward();">
                    <select id="forwardSec">
                        <option value=3>3秒</option>
                        <option value=5>5秒</option>
                        <option value=10>10秒</option>
                        <option value=15>15秒</option>
                        <option value=30>30秒</option>
                        <option value=60 selected>1分</option>
                        <option value=120>2分</option>
                        <option value=180>3分</option>
                        <option value=300>5分</option>
                        <option value=600>10分</option>
                    </select>
                    <span class="shortcut">(W)</span> <span class="controlButton">▶▶</span>
                </div>
            </div>
            <div id="howto">
                <h1>■使い方</h1>
                <ul>
                    <li>右の発話リストから聞きたい発話をクリックすると当該箇所が再生されます。</li>
                    <li>スペースキーで再生、一時停止切り替え</li>
                    <li>「w」キーで指定秒数進む</li>
                    <li>「q」キーで指定秒数戻る</li>
                    <li>秒数はプルダウンメニューで指定</li>
                    <li>動作確認ブラウザ：Microsoft Edge（Chromium版）またはGoogle Chrome</li>
                </ul>
            </div>        
        </div>
        <!--発話一覧-->
        <div id="scripts">
        </div>
    </div>

<footer>動画眼Lite by do-gugan.com</footer>
</body>
</html>
